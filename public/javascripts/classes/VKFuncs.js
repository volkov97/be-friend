define([],function(){var e,n={};return n.setId=function(n){e.id=n},n.getId=function(){return e.id},n.getUser=function(){return e.mid},n.getUserInfo=function(){return{id:e.mid,first_name:e.user.first_name,last_name:e.user.last_name,img_src:e.img_src}},n.loginUser=function(){return new Promise(function(s,r){VK.Auth.login(function(i){i.session?(e=i.session,n.getFriendsIDs(s,r)):console.log("login err")})})},n.getFriendsIDs=function(s,r){VK.Api.call("friends.get",{user_id:e.mid,v:"5.53"},function(i){console.log(i.response),i.response&&(friends=i.response.items,stringOfUserIDs=e.mid+","+friends.join(),n.getFriendsInfo(s,r)),i.error&&console.log(i.error)})},n.getFriendsInfo=function(s,r){VK.Api.call("users.get",{user_ids:stringOfUserIDs,fields:"bdate,city,photo_200,relation,education,universities,schools,status,followers_count,sex,followers_count,personal,first_name_gen,last_name_gen,relation",v:"5.53"},function(i){i.response&&(friends=i.response,e.img_src=friends.shift().photo_200,friends=friends.filter(function(e){return"deleted"!=e.deactivated}),stringOfUsersCitiesIDs=friends.map(function(e){return e.city}).join(),n.getFriendsCities(s,r)),i.error&&console.log(i.error)})},n.getFriendsCities=function(n,s){VK.Api.call("database.getCitiesById",{city_ids:stringOfUsersCitiesIDs,v:"5.53"},function(s){if(s.response){for(var r=s.response,i=0;i<friends.length;i++)for(var t=friends[i].city,o=0;o<r.length;o++)t==r[o].cid&&(friends[i].cityName=r[o].name);var f={first_name:e.user.first_name,last_name:e.user.last_name,vk_id:e.user.id};$.post("/auth",f,function(e){n(e)},"json")}s.error&&console.log(s.error)})},n});