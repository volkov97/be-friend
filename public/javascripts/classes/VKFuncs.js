define([],function(){var e,n={};return n.setId=function(n){e.id=n},n.getId=function(){return e.id},n.getUser=function(){return e.mid},n.getUserInfo=function(){return{id:e.mid,first_name:e.user.first_name,last_name:e.user.last_name,img_src:e.img_src}},n.loginUser=function(){return new Promise(function(s,i){VK.Auth.login(function(r){r.session?(e=r.session,n.getFriendsIDs(s,i)):console.log("login err")})})},n.getFriendsIDs=function(s,i){VK.Api.call("friends.get",{user_id:e.mid,v:"5.53"},function(r){r.response&&(friends=r.response.items,stringOfUserIDs=e.mid+","+friends.join(),n.getFriendsInfo(s,i)),r.error&&console.log(r.error)})},n.getFriendsInfo=function(s,i){VK.Api.call("users.get",{user_ids:stringOfUserIDs,fields:"bdate,city,photo_200,relation,education,universities,schools,status,followers_count,sex,followers_count,personal,first_name_gen,last_name_gen,relation",v:"5.53"},function(r){r.response&&(friends=r.response,e.img_src=friends.shift().photo_200,friends=friends.filter(function(e){return"deleted"!=e.deactivated}),stringOfUsersCitiesIDs=friends.map(function(e){return e.city}).join(),n.getFriendsCities(s,i)),r.error&&console.log(r.error)})},n.getFriendsCities=function(n,s){VK.Api.call("database.getCitiesById",{city_ids:stringOfUsersCitiesIDs,v:"5.53"},function(s){if(s.response){for(var i=s.response,r=0;r<friends.length;r++)for(var t=friends[r].city,o=0;o<i.length;o++)t==i[o].cid&&(friends[r].cityName=i[o].name);var f={first_name:e.user.first_name,last_name:e.user.last_name,vk_id:e.user.id};$.post("/auth",f,function(e){n(e)},"json")}s.error&&console.log(s.error)})},n});